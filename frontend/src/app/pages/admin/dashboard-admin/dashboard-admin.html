<!-- üé® Dashboard Ultra-Moderne -->
<div class="dashboard-container">
  <div class="dashboard-header mb-4">
    <h1 class="dashboard-title">
      <i class="fas fa-chart-line"></i>
      Tableau de Bord Administrateur
    </h1>
    <p class="dashboard-subtitle">Vue d'ensemble de votre plateforme d'abonnements</p>
  </div>

  <div class="row g-4" *ngIf="!loading; else loadingTpl">

  <!-- üíé Cartes Statistiques Ultra-Modernes -->
  <div class="col-lg-4 col-md-6">
    <div class="earning-card users-card text-white overflow-hidden">
      <span class="round small"></span>
      <span class="round big"></span>
      <div class="avatar">
        <i class="fas fa-users"></i>
      </div>
      <h1 class="number-display">{{ userCount }}</h1>
      <p class="card-label">Utilisateurs Enregistr√©s</p>
    </div>
  </div>

  <div class="col-lg-4 col-md-6">
    <div class="earning-card providers-card text-white overflow-hidden">
      <span class="round small"></span>
      <span class="round big"></span>
      <div class="avatar">
        <i class="fas fa-building"></i>
      </div>
      <h1 class="number-display">{{ providerCount }}</h1>
      <p class="card-label">Fournisseurs Actifs</p>
    </div>
  </div>

  <div class="col-lg-4 col-md-12">
    <div class="earning-card subscriptions-card text-white overflow-hidden">
      <span class="round small"></span>
      <span class="round big"></span>
      <div class="avatar">
        <i class="fas fa-credit-card"></i>
      </div>
      <h1 class="number-display">{{ subscriptionCount }}</h1>
      <p class="card-label">Abonnements Actifs</p>
    </div>
  </div>

  <!-- üìä Graphiques Ultra-Modernes -->
  <div class="col-lg-6 col-md-12">
    <div class="chart-card">
      <h5 class="chart-title">
        <i class="fas fa-chart-pie"></i>
        R√©partition des Utilisateurs
      </h5>
      <div class="chart-container">
        <apx-chart [series]="pieChartOptions.series"
                   [chart]="pieChartOptions.chart"
                   [labels]="pieChartOptions.labels"
                   [title]="pieChartOptions.title"
                   [responsive]="pieChartOptions.responsive">
        </apx-chart>
      </div>
    </div>
  </div>

  <div class="col-lg-6 col-md-12">
    <div class="chart-card">
      <h5 class="chart-title">
        <i class="fas fa-chart-bar"></i>
        Abonnements par Mois
      </h5>
      <div class="chart-container">
        <apx-chart [series]="barChartOptions.series"
                   [chart]="barChartOptions.chart"
                   [xaxis]="barChartOptions.xaxis"
                   [title]="barChartOptions.title"
                   [responsive]="barChartOptions.responsive">
        </apx-chart>
      </div>
    </div>
  </div>

  <!-- üö® Messages d'Alerte Ultra-Modernes -->
  <div *ngIf="alertMessage" class="col-12">
    <div class="alert" [ngClass]="{'alert-success': alertType==='success','alert-danger': alertType==='error'}" role="alert">
      <i class="fas" [ngClass]="{'fa-check-circle': alertType==='success', 'fa-exclamation-triangle': alertType==='error'}"></i>
      {{ alertMessage }}
      <button type="button" class="btn-close" aria-label="Close" (click)="alertMessage = ''">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- üìã Tableau Utilisateurs Ultra-Moderne -->
  <div class="col-12">
    <div class="table-card">
      <div class="table-header">
        <h4 class="table-title">
          <i class="fas fa-users"></i>
          Gestion des Utilisateurs
        </h4>
        <button class="btn btn-add-user" (click)="openAddUser()">
          <i class="fas fa-plus"></i>
          <span>Ajouter Utilisateur</span>
        </button>
      </div>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>
                <i class="fas fa-user"></i>
                Nom
              </th>
              <th>
                <i class="fas fa-envelope"></i>
                Email
              </th>
              <th>
                <i class="fas fa-shield-alt"></i>
                R√¥le
              </th>
              <th>
                <i class="fas fa-cogs"></i>
                Actions
              </th>
            </tr>
          </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <span class="badge bg-primary" *ngIf="user.role==='admin'">Admin</span>
                  <span class="badge bg-secondary" *ngIf="!user.role || user.role==='user'">User</span>
                </td>
                <td>
                  <button class="btn btn-sm btn-warning me-1" (click)="openEditUser(user)">Modifier</button>
                  <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">Supprimer</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Bouton R√©clamations -->
  <div class="col-12 mt-4">
    <button class="btn btn-danger" (click)="openReclamations()">Voir les r√©clamations</button>
  </div>

  </div> <!-- Fin row -->


<!-- Modal Ajout / Modification Utilisateur -->
<div class="modal" tabindex="-1" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-custom">
      <div class="modal-header">
        <h5 class="modal-title">{{ editingUser ? 'Modifier Utilisateur' : 'Ajouter Utilisateur' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form #userForm="ngForm">
          <div class="mb-3">
            <label class="form-label">Nom</label>
            <input type="text" class="form-control" [(ngModel)]="userFormModel.name" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" [(ngModel)]="userFormModel.email" name="email" required>
          </div>
          <div class="mb-3">
            <label class="form-label">R√¥le</label>
            <select class="form-select" [(ngModel)]="userFormModel.role" name="role">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Annuler</button>
        <button class="btn btn-primary" (click)="saveUser()">{{ editingUser ? 'Modifier' : 'Ajouter' }}</button>
      </div>
    </div>
  </div>
</div>

<!-- üé≠ Modal R√©clamations Ultra-Moderne -->
<div class="modal modal-reclamations" tabindex="-1" [class.show]="showReclamationsModal" [style.display]="showReclamationsModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content modal-reclamations-content">

      <!-- Header Ultra-Moderne -->
      <div class="modal-header modal-reclamations-header">
        <div class="modal-title-container">
          <div class="modal-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="modal-title-text">
            <h4 class="modal-title">Gestion des R√©clamations</h4>
            <p class="modal-subtitle">Centre de traitement des demandes clients</p>
          </div>
        </div>
        <button type="button" class="btn-close-modern" (click)="closeReclamationsModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Body Ultra-Moderne -->
      <div class="modal-body modal-reclamations-body">

        <!-- Statistiques des r√©clamations -->
        <div class="reclamations-stats" *ngIf="reclamations.length > 0">
          <div class="stat-item">
            <div class="stat-icon pending">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ getReclamationsByStatus('pending').length }}</span>
              <span class="stat-label">En Attente</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon resolved">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ getReclamationsByStatus('resolved').length }}</span>
              <span class="stat-label">R√©solues</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon rejected">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ getReclamationsByStatus('rejected').length }}</span>
              <span class="stat-label">Rejet√©es</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon total">
              <i class="fas fa-list"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ reclamations.length }}</span>
              <span class="stat-label">Total</span>
            </div>
          </div>
        </div>

        <!-- Liste des r√©clamations -->
        <div *ngIf="reclamations.length > 0; else noReclamations" class="reclamations-container">
          <div class="reclamations-grid">
            <div *ngFor="let rec of reclamations; let i = index"
                 class="reclamation-card"
                 [ngClass]="getReclamationCardClass(rec.status)">

              <!-- Header de la carte -->
              <div class="reclamation-header">
                <div class="reclamation-user">
                  <div class="user-avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="user-info">
                    <h6 class="user-name">{{ rec.email || 'Utilisateur Anonyme' }}</h6>
                    <p class="user-subject">{{ rec.name || 'Sans objet' }}</p>
                  </div>
                </div>

                <div class="reclamation-status">
                  <span class="status-badge" [ngClass]="getStatusBadgeClass(rec.status)">
                    <i [class]="getStatusIcon(rec.status)"></i>
                    {{ getStatusText(rec.status) }}
                  </span>
                </div>
              </div>

              <!-- Contenu de la r√©clamation -->
              <div class="reclamation-content">
                <p class="reclamation-message">{{ rec.message }}</p>
              </div>

              <!-- Footer de la carte -->
              <div class="reclamation-footer">
                <div class="reclamation-date">
                  <i class="fas fa-calendar-alt"></i>
                  <span>{{ rec.created_at | date:'dd/MM/yyyy √† HH:mm' }}</span>
                </div>

                <div class="reclamation-actions">
                  <button class="btn-action btn-resolve"
                          *ngIf="rec.status === 'pending'"
                          (click)="updateReclamationStatus(rec.id!, 'resolved')"
                          title="Marquer comme r√©solu">
                    <i class="fas fa-check"></i>
                  </button>

                  <button class="btn-action btn-reject"
                          *ngIf="rec.status === 'pending'"
                          (click)="updateReclamationStatus(rec.id!, 'rejected')"
                          title="Rejeter la r√©clamation">
                    <i class="fas fa-times"></i>
                  </button>

                  <button class="btn-action btn-delete"
                          (click)="deleteReclamation(rec.id!)"
                          title="Supprimer d√©finitivement">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- √âtat vide -->
        <ng-template #noReclamations>
          <div class="empty-reclamations">
            <div class="empty-icon">
              <i class="fas fa-inbox"></i>
            </div>
            <h4>Aucune r√©clamation</h4>
            <p>Parfait ! Aucune r√©clamation n'a √©t√© soumise pour le moment.</p>
          </div>
        </ng-template>
      </div>

      <!-- Footer Ultra-Moderne -->
      <div class="modal-footer modal-reclamations-footer">
        <div class="footer-info">
          <i class="fas fa-info-circle"></i>
          <span>{{ reclamations.length }} r√©clamation(s) au total</span>
        </div>
        <button type="button" class="btn btn-close-modal" (click)="closeReclamationsModal()">
          <i class="fas fa-times"></i>
          <span>Fermer</span>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Loading Template -->
<ng-template #loadingTpl>
  <div class="loading-container text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2">Chargement du dashboard...</p>
  </div>
</ng-template>
